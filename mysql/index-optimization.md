# 優化技巧

### 1. 選擇合適的列建立索引

* 高選擇性列：選擇基數（唯一值數量）高的列
* 常用於查詢條件的列
* 頻繁在 ORDER BY 和 GROUP BY 子句中使用的列
* 外鍵關係的列

### 2. 遵循左前綴原則

* 在複合索引中，最左側的列必須存在於查詢條件中
* 例：索引(A, B, C)可用於查詢A、(A,B)、(A,B,C)，但不適用於只有B或C的查詢

### 3. 利用覆蓋索引

覆蓋索引是一種特殊的索引，它包含了查詢所需的所有列，使得資料庫可以直接從索引中獲取所需資訊，而無需額外訪問表中的資料行。這種索引可以顯著提高查詢效率，因為它避免了回表操作。

* 創建包含查詢所需所有列的索引
* 避免回表操作[^1]，提高查詢效率

### 4. 注意索引列的獨立性

* 避免在索引列上使用函數或表達式
* 錯誤示例：WHERE YEAR(create\_time) = 2023
* 正確示例：WHERE create\_time BETWEEN '2023-01-01' AND '2023-12-31'

### 5. 合理使用複合索引

* 根據查詢頻率和條件順序設計複合索引
* 避免創建冗餘的索引

### 6. 使用前綴索引

* 對於長字符串列，可以只索引開始的一部分
* 例：CREATE INDEX idx\_name ON table (column(10))

### 7. 避免過度索引

* 每個額外的索引都會增加寫入開銷
* 定期檢查和刪除不再使用的索引

### 8. 利用索引進行排序

* 索引可以幫助避免文件排序操作
* 確保 ORDER BY 子句與索引的列順序一致

### 9. 正確使用聯合索引

* 在多表連接查詢中，在連接列上創建適當的索引

### 10. 定期維護索引

* 使用 ANALYZE TABLE 更新索引統計信息
* 考慮重建高度碎片化的索引

### 11. 使用 EXPLAIN 分析查詢

* 理解查詢的執行計劃
* 識別潛在的索引優化機會

### 12. 考慮使用 InnoDB 的自適應哈希索引

* 對於適用的工作負載，可以提高性能
* 可以通過調整 innodb\_adaptive\_hash\_index 參數來啟用或禁用

### 13. 利用新版 MySQL 的索引特性

* MySQL 8.0 引入了降序索引、隱藏索引等新特性
* 根據實際需求使用這些新特性來優化性能

正確應用這些技巧可以顯著提高資料庫的查詢性能。然而，索引優化是一個需要持續關注和調整的過程，應根據實際的查詢模式和資料變化來進行優化。

這些技巧涵蓋了索引優化的主要方面。以下是一些額外的說明和實際應用的例子：

1.  選擇性評估： 使用類似以下的查詢來評估列的選擇性：

    ```sql
    SELECT COUNT(DISTINCT column_name) / COUNT(*) AS selectivity
    FROM table_name;

    ```

    選擇性接近 1 的列通常是好的索引候選。
2. 覆蓋索引示例： 如果經常執行 `SELECT email FROM users WHERE status = 'active'`， 可以創建覆蓋索引：`CREATE INDEX idx_status_email ON users(status, email);`
3. 複合索引順序： 對於查詢 `WHERE a = ? AND b = ?`，索引 (a, b) 通常比 (b, a) 更有效。
4.  避免過度索引的實踐： 定期檢查索引使用情況：

    ```sql
    SELECT * FROM sys.schema_unused_indexes;

    ```
5. EXPLAIN 使用： 使用 `EXPLAIN FORMAT=JSON SELECT ...` 可以獲得更詳細的執行計劃信息。
6.  索引維護： 對於頻繁更新的表，可以考慮定期重建索引：

    ```sql
    ALTER TABLE table_name DROP INDEX index_name;
    ALTER TABLE table_name ADD INDEX index_name (column_list);

    ```
7. 特定場景優化：
   * 對於全文搜索，考慮使用全文索引而不是 LIKE 操作。
   * 對於地理位置資料，使用空間索引可以顯著提高性能。

索引優化是一個需要深入理解資料庫原理和具體應用場景的領域。它需要權衡查詢性能、寫入開銷和存儲空間等因素。在實際應用中，往往需要結合具體的查詢模式和資料特點來制定最佳的索引策略。

[^1]: 是指在資料庫查詢中，通過使用覆蓋索引來減少額外的資料訪問操作。這種技術可以顯著提高查詢效率，因為所有需要的資料都可以直接從索引中獲得，無需再次訪問表中的資料行。